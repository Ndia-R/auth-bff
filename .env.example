# ============================================
# Identity Provider Configuration
# ============================================
# このBFFはOIDC準拠のすべてのIDプロバイダーに対応しています。
# 以下はKeycloakの設定例です。他のプロバイダーの例は末尾を参照してください。

IDP_CLIENT_ID=my-books-client
IDP_CLIENT_SECRET=your-client-secret

# OAuth2リダイレクトURI（IDプロバイダー認証後のコールバックURL）
# Spring Securityが自動的に /login/oauth2/code/{registrationId} エンドポイントを作成
# 注: IDプロバイダー側の管理画面でこのURLを許可リストに追加する必要があります
IDP_REDIRECT_URI=http://localhost:8888/bff/login/oauth2/code/idp

# ISSUER_URI: IDプロバイダーのベースURL（プロバイダーごとに異なるパス構造）
# Keycloakの例: /realms/{realm-name} という構造
IDP_ISSUER_URI=http://nginx/realms/test-user-realm

# 注: 現在の実装では、BFFがバックエンドからWebClientでIDプロバイダーにログアウトリクエストを送信するため、
# 以下のpost_logout_redirect_uriはブラウザには届きません。
# フロントエンド側で /bff/auth/logout のレスポンスを受け取った後、独自にリダイレクト処理を実装してください。
IDP_POST_LOGOUT_REDIRECT_URI=http://localhost:5173/logout-complete

# ============================================
# Redis Configuration
# ============================================
REDIS_HOST=redis
REDIS_PORT=6379

# ============================================
# Application Configuration
# ============================================
# フロントエンドURL
FRONTEND_URL=http://localhost:5173

# リソースサーバーURL
RESOURCE_SERVER_URL=http://resource-server:8080

# タイムアウト設定（秒）
# WebClient経由のリソースサーバーへの接続・読み込み・書き込みタイムアウト
RESOURCE_SERVER_TIMEOUT=30

# CORS許可オリジン（カンマ区切り）
CORS_ALLOWED_ORIGINS=http://localhost:5173,http://localhost:*

# ============================================
# Rate Limit Configuration
# ============================================
# レート制限機能の有効/無効
RATE_LIMIT_ENABLED=true

# 認証エンドポイントのレート制限（/bff/auth/login）
RATE_LIMIT_AUTH_RPM=30

# APIプロキシのレート制限（/api/**）
# 認証済みユーザー（セッションIDベース）
RATE_LIMIT_API_AUTHENTICATED_RPM=200
# 未認証ユーザー（IPアドレスベース）未認証でもアクセス可能なエンドポイントを保護
RATE_LIMIT_API_ANONYMOUS_RPM=100

# ============================================
# IDプロバイダー別 ISSUER_URI 設定例
# ============================================

# Keycloak
# IDP_ISSUER_URI=http://localhost:8444/realms/test-user-realm

# Auth0
# IDP_ISSUER_URI=https://your-tenant.auth0.com

# Okta
# IDP_ISSUER_URI=https://dev-12345678.okta.com/oauth2/default

# Azure AD (Microsoft Entra ID)
# IDP_ISSUER_URI=https://login.microsoftonline.com/{tenant-id}/v2.0

# Google Identity Platform
# IDP_ISSUER_URI=https://accounts.google.com

# AWS Cognito
# IDP_ISSUER_URI=https://cognito-idp.{region}.amazonaws.com/{user-pool-id}