services:
  auth-bff:
    build:
      context: .
      dockerfile: Dockerfile
      target: development
    ports:
      - 8888:8080
    environment:
      TZ: Asia/Tokyo
      # Identity Provider Configuration
      IDP_CLIENT_ID: ${IDP_CLIENT_ID}
      IDP_CLIENT_SECRET: ${IDP_CLIENT_SECRET}
      IDP_REDIRECT_URI: ${IDP_REDIRECT_URI}
      IDP_ISSUER_URI: ${IDP_ISSUER_URI}
      IDP_POST_LOGOUT_REDIRECT_URI: ${IDP_POST_LOGOUT_REDIRECT_URI}
      # Redis Configuration
      REDIS_HOST: ${REDIS_HOST}
      REDIS_PORT: ${REDIS_PORT}
      # Application Configuration
      FRONTEND_URL: ${FRONTEND_URL}
      RESOURCE_SERVER_URL: ${RESOURCE_SERVER_URL}
      CORS_ALLOWED_ORIGINS: ${CORS_ALLOWED_ORIGINS}
      RATE_LIMIT_ENABLED: ${RATE_LIMIT_ENABLED}
      RATE_LIMIT_AUTH_RPM: ${RATE_LIMIT_AUTH_RPM}
      RATE_LIMIT_API_RPM: ${RATE_LIMIT_API_RPM}
      RESOURCE_SERVER_TIMEOUT: ${RESOURCE_SERVER_TIMEOUT}
    volumes:
      - .:/workspace
      - gradle-cache:/home/vscode/.gradle
      - claude-config:/home/vscode/.claude
    extra_hosts:
      - "auth.localhost:host-gateway"
    depends_on:
      - redis
    networks:
      - shared-network
    command: sleep infinity

  redis:
    image: redis:8.2
    ports:
      - 6379:6379
    networks:
      - shared-network

volumes:
  gradle-cache:
  claude-config:

networks:
  shared-network:
    driver: bridge